<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#2563eb" />
    <title>Invoice App (KSh) â€” v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* subtle scrollbar for desktop */
      ::-webkit-scrollbar { height: 8px; width: 8px }
      ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 8px }
      html, body { background:#f8fafc }
    </style>
  </head>
  <body class="text-slate-900">
    <div id="root" class="p-4 min-h-screen"></div>

    <!-- React & Babel (development builds) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
// =====================
// Helpers & persistence
// =====================
const { useState, useEffect, useMemo } = React;

const uid = (prefix='id') => `${prefix}-${Date.now().toString(36)}-${Math.floor(Math.random()*1000)}`;
const money = (n) => `KSh ${Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;

function load(key, fallback) {
  try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; } catch(e){ return fallback }
}
function save(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

// =====================
// Main App
// =====================
function App(){
  // ---------- data stores ----------
  const [products, setProducts] = useState(() => load('ia_products_v2', [
    { id: uid('p'), name:'Soap',     price: 80,  cost: 40, stock: 100 },
    { id: uid('p'), name:'Shampoo',  price: 220, cost: 150, stock: 30  },
  ]));
  const [clients, setClients] = useState(() => load('ia_clients_v2', [
    { id: uid('c'), name:'John Doe', phone:'0710000000' },
    { id: uid('c'), name:'Mary Jane', phone:'0720000000' },
  ]));
  const [invoices, setInvoices] = useState(() => load('ia_invoices_v2', []));
  const [payments, setPayments] = useState(() => load('ia_payments_v2', [])); // client-level payments log
  const [counter, setCounter] = useState(() => load('ia_counter_v2', 1)); // invoice number counter

  // ---------- persist ----------
  useEffect(()=> save('ia_products_v2', products), [products]);
  useEffect(()=> save('ia_clients_v2', clients), [clients]);
  useEffect(()=> save('ia_invoices_v2', invoices), [invoices]);
  useEffect(()=> save('ia_payments_v2', payments), [payments]);
  useEffect(()=> save('ia_counter_v2', counter), [counter]);

  // ---------- UI state ----------
  const [tab, setTab] = useState('invoices');

  // ---------- computations ----------
  const lineTotal = (it) => {
    const unit = Number(it.unitPrice||0);
    const discEach = Math.min(Number(it.discountEach||0), unit); // avoid negative
    const q = Number(it.quantity||0);
    return (unit - discEach) * q;
  };
  const invoiceTotals = (items) => items.reduce((sum,it)=> sum + lineTotal(it), 0);
  const invoiceCost = (items) => items.reduce((sum,it)=> sum + Number(it.costPrice||0) * Number(it.quantity||0), 0);
  const invoiceProfit = (items) => items.reduce((sum,it)=> sum + ((Number(it.unitPrice||0) - Number(it.discountEach||0) - Number(it.costPrice||0)) * Number(it.quantity||0)), 0);

  const paymentsForClient = (clientId) => payments.filter(p=> p.clientId===clientId).reduce((s,p)=> s + Number(p.amount||0), 0);
  const invoicesTotalForClient = (clientId) => invoices.filter(i=> i.clientId===clientId).reduce((s,i)=> s + Number(i.total||0), 0);
  const outstandingForClient = (clientId) => invoicesTotalForClient(clientId) - paymentsForClient(clientId);

  const outstandingOverall = useMemo(()=> {
    const invoiceSum = invoices.reduce((s,i)=> s + Number(i.total||0), 0);
    const paymentSum = payments.reduce((s,p)=> s + Number(p.amount||0), 0);
    return invoiceSum - paymentSum;
  }, [invoices, payments]);

  // =====================
  // Product CRUD
  // =====================
  const [pName, setPName] = useState('');
  const [pPrice, setPPrice] = useState('');
  const [pCost, setPCost] = useState('');
  const [pStock, setPStock] = useState('');

  function addProduct(e){
    e.preventDefault();
    if(!pName || pPrice==='') return alert('Name and selling price are required');
    const p = { id: uid('p'), name: pName.trim(), price: Number(pPrice||0), cost: Number(pCost||0), stock: Number(pStock||0) };
    setProducts(prev=> [p, ...prev]);
    setPName(''); setPPrice(''); setPCost(''); setPStock('');
  }

  // =====================
  // Client CRUD + payments
  // =====================
  const [cName, setCName] = useState('');
  const [cPhone, setCPhone] = useState('');
  const [clientQuery, setClientQuery] = useState('');
  const filteredClients = useMemo(()=> {
    const q = clientQuery.trim().toLowerCase();
    if(!q) return clients;
    return clients.filter(c=> (c.name||'').toLowerCase().includes(q) || (c.phone||'').toLowerCase().includes(q));
  }, [clients, clientQuery]);

  function addClient(e){
    e.preventDefault();
    if(!cName) return alert('Client name is required');
    const c = { id: uid('c'), name: cName.trim(), phone: cPhone.trim() };
    setClients(prev=> [c, ...prev]);
    setCName(''); setCPhone('');
  }

  function addPayment(clientId, amount, method, dateISO, note){
    if(!amount || Number(amount)<=0) return alert('Enter a positive amount');
    const pay = { id: uid('pay'), clientId, amount: Number(amount), method: method||'Cash', date: dateISO || new Date().toISOString(), note: note||'' };
    setPayments(prev=> [pay, ...prev]);
  }

  function deletePayment(id){
    if(!confirm('Delete this payment?')) return; setPayments(prev=> prev.filter(p=> p.id!==id));
  }

  // =====================
  // Invoice create
  // =====================
  const [creating, setCreating] = useState(false);
  const [invClientId, setInvClientId] = useState('');
  const [invItems, setInvItems] = useState([]);

  const getClient = (id) => clients.find(c=> c.id===id) || null;
  const getProduct = (id) => products.find(p=> p.id===id) || null;

  function startInvoice(){
    setCreating(true);
    setInvClientId('');
    setInvItems([]);
  }

  function addItem(){
    setInvItems(prev=> [...prev, { id: uid('li'), productId:'', unitPrice:0, discountEach:0, quantity:1, costPrice:0 }]);
  }
  function updateItem(idx, patch){ setInvItems(prev=> prev.map((it,i)=> i===idx ? {...it, ...patch} : it)); }
  function removeItem(idx){ setInvItems(prev=> prev.filter((_,i)=> i!==idx)); }

  function saveInvoice(){
    if(!invClientId) return alert('Choose a client');
    if(invItems.length===0) return alert('Add at least one item');

    // normalize + snapshot cost
    const norm = invItems.map(it=>{
      const p = getProduct(it.productId);
      const unit = Number(it.unitPrice||0);
      const disc = Math.min(Number(it.discountEach||0), unit);
      const qty  = Number(it.quantity||0);
      const cost = p ? Number(p.cost||0) : Number(it.costPrice||0)||0; // snapshot cost
      return { ...it, unitPrice: unit, discountEach: disc, quantity: qty, costPrice: cost };
    });

    const total = invoiceTotals(norm);
    const costTotal = invoiceCost(norm);
    const profitTotal = total - costTotal;

    const number = 'INV-' + String(counter).padStart(4,'0');
    const inv = {
      id: uid('inv'),
      number,
      date: new Date().toISOString(),
      clientId: invClientId,
      items: norm,
      total: Number(total),
      costTotal: Number(costTotal),
      profitTotal: Number(profitTotal)
    };

    // reduce stock
    const up = [...products];
    norm.forEach(it=>{
      const p = up.find(x=> x.id===it.productId);
      if(p) p.stock = Math.max(0, Number(p.stock||0) - Number(it.quantity||0));
    });

    setProducts(up);
    setInvoices(prev=> [inv, ...prev]);
    setCounter(prev=> prev+1);

    setCreating(false); setInvClientId(''); setInvItems([]);
    alert(`Invoice saved: ${number}`);
  }

  // =====================
  // Export / Import (backup)
  // =====================
  function exportData(){
    const payload = { products, clients, invoices, payments, counter };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='invoice-data-v2.json'; a.click(); URL.revokeObjectURL(url);
  }
  function importData(file){
    const r = new FileReader();
    r.onload = (e)=>{
      try{
        const obj = JSON.parse(e.target.result);
        if(obj.products) setProducts(obj.products);
        if(obj.clients) setClients(obj.clients);
        if(obj.invoices) setInvoices(obj.invoices);
        if(obj.payments) setPayments(obj.payments);
        if(obj.counter) setCounter(obj.counter);
        alert('Data imported');
      }catch(err){ alert('Invalid file'); }
    };
    r.readAsText(file);
  }

  // =====================
  // Tabs UI
  // =====================
  const ProductsTab = (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
      <form className="p-4 bg-white rounded-xl shadow" onSubmit={addProduct}>
        <h3 className="font-semibold mb-3">Add product</h3>
        <input className="w-full mb-2 p-2 border rounded" placeholder="Product name" value={pName} onChange={e=>setPName(e.target.value)} />
        <div className="grid grid-cols-2 gap-2 mb-2">
          <input className="p-2 border rounded" placeholder="Selling price (KSh)" value={pPrice} onChange={e=>setPPrice(e.target.value)} />
          <input className="p-2 border rounded" placeholder="Cost price (KSh)" value={pCost} onChange={e=>setPCost(e.target.value)} />
        </div>
        <input className="w-full mb-3 p-2 border rounded" placeholder="Stock qty" value={pStock} onChange={e=>setPStock(e.target.value)} />
        <div className="flex gap-2">
          <button className="px-3 py-1 bg-blue-600 text-white rounded" type="submit">Add</button>
          <button type="button" className="px-3 py-1 border rounded" onClick={()=>{setPName('');setPPrice('');setPCost('');setPStock('')}}>Clear</button>
        </div>
      </form>

      <div className="p-4 bg-white rounded-xl shadow">
        <div className="flex items-center justify-between mb-2">
          <h3 className="font-semibold">Products ({products.length})</h3>
        </div>
        <div className="space-y-2 max-h-72 overflow-auto">
          {products.map(p=> (
            <div key={p.id} className="flex items-center justify-between p-2 border rounded">
              <div>
                <div className="font-medium">{p.name}</div>
                <div className="text-sm text-slate-600">Price: {money(p.price)} | Cost: {money(p.cost)} | Stock: {p.stock}</div>
              </div>
              <div className="flex gap-2">
                <button className="text-sm px-2 py-1 border rounded" onClick={()=>{
                  const name = prompt('New name', p.name); if(name===null) return;
                  const price = prompt('New selling price', p.price); if(price===null) return;
                  const cost = prompt('New cost price', p.cost); if(cost===null) return;
                  const stock = prompt('New stock qty', p.stock); if(stock===null) return;
                  setProducts(prev=> prev.map(x=> x.id===p.id? {...x, name, price:Number(price), cost:Number(cost), stock:Number(stock)}:x));
                }}>Edit</button>
                <button className="text-sm px-2 py-1 border rounded" onClick={()=>{
                  if(!confirm('Delete product?')) return; setProducts(prev=> prev.filter(x=> x.id!==p.id));
                }}>Delete</button>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const ClientsTab = (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
      {/* Add client */}
      <form className="p-4 bg-white rounded-xl shadow" onSubmit={addClient}>
        <h3 className="font-semibold mb-3">Add client</h3>
        <input className="w-full mb-2 p-2 border rounded" placeholder="Client name" value={cName} onChange={e=>setCName(e.target.value)} />
        <input className="w-full mb-3 p-2 border rounded" placeholder="Phone (optional)" value={cPhone} onChange={e=>setCPhone(e.target.value)} />
        <div className="flex gap-2">
          <button className="px-3 py-1 bg-blue-600 text-white rounded" type="submit">Add</button>
          <button type="button" className="px-3 py-1 border rounded" onClick={()=>{setCName(''); setCPhone('')}}>Clear</button>
        </div>
      </form>

      {/* Search + list */}
      <div className="p-4 bg-white rounded-xl shadow">
        <div className="flex items-center justify-between mb-2">
          <h3 className="font-semibold">Clients ({clients.length})</h3>
        </div>
        <input className="w-full mb-3 p-2 border rounded" placeholder="Search by name or phone" value={clientQuery} onChange={e=>setClientQuery(e.target.value)} />

        <div className="space-y-2 max-h-96 overflow-auto">
          {filteredClients.map(c=> (
            <ClientRow key={c.id}
              client={c}
              outstanding={outstandingForClient(c.id)}
              payments={payments.filter(p=> p.clientId===c.id)}
              onAddPayment={(amount,method,dateISO,note)=> addPayment(c.id, amount, method, dateISO, note)}
              onDeletePayment={deletePayment}
            />
          ))}
        </div>
      </div>
    </div>
  );

  const InvoicesTab = (
    <div>
      <div className="mb-4 flex items-center justify-between gap-2">
        <div className="flex gap-2">
          <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={startInvoice}>+ Add Invoice</button>
          <button className="px-3 py-1 border rounded" onClick={exportData}>Export</button>
          <label className="px-3 py-1 border rounded cursor-pointer">Import
            <input type="file" accept="application/json" style={{display:'none'}} onChange={e=> importData(e.target.files[0])} />
          </label>
        </div>
        <div className="text-sm text-slate-600">Invoices: {invoices.length}</div>
      </div>

      {creating && (
        <div className="p-4 bg-white rounded-xl shadow mb-4">
          <h3 className="font-semibold mb-3">New Invoice</h3>

          <label className="block text-sm text-slate-700 mb-1">Client</label>
          <select className="w-full p-2 border rounded mb-3" value={invClientId} onChange={e=> setInvClientId(e.target.value)}>
            <option value="">-- choose client --</option>
            {clients.map(c=> <option key={c.id} value={c.id}>{c.name}</option>)}
          </select>
          {invClientId && (
            <div className="mb-3 text-sm text-slate-600">Outstanding (before this invoice): <span className="font-medium">{money(outstandingForClient(invClientId))}</span></div>
          )}

          <div className="mb-3">
            <label className="block text-sm text-slate-700 mb-1">Items</label>
            <div className="space-y-2">
              {invItems.map((it, idx)=> (
                <div key={it.id} className="grid grid-cols-12 gap-2 items-center">
                  <div className="col-span-5">
                    <select className="w-full p-2 border rounded" value={it.productId} onChange={e=>{
                      const pid = e.target.value; const prod = getProduct(pid);
                      updateItem(idx, { productId: pid, unitPrice: prod? Number(prod.price||0):0, costPrice: prod? Number(prod.cost||0):0 });
                    }}>
                      <option value="">-- product --</option>
                      {products.map(p=> <option key={p.id} value={p.id}>{p.name}</option>)}
                    </select>
                  </div>
                  <div className="col-span-2"><input className="w-full p-2 border rounded text-right" placeholder="Price" value={it.unitPrice} onChange={e=> updateItem(idx, { unitPrice: e.target.value })} /></div>
                  <div className="col-span-2"><input className="w-full p-2 border rounded text-right" placeholder="Qty" value={it.quantity} onChange={e=> updateItem(idx, { quantity: e.target.value })} /></div>
                  <div className="col-span-2"><input className="w-full p-2 border rounded text-right" placeholder="Disc/Item (KSh)" value={it.discountEach} onChange={e=> updateItem(idx, { discountEach: e.target.value })} /></div>
                  <div className="col-span-1 text-right">
                    <div className="text-sm">{money(lineTotal({ ...it, unitPrice:Number(it.unitPrice||0), discountEach:Number(it.discountEach||0), quantity:Number(it.quantity||0) }))}</div>
                    <button className="text-xs text-red-600" onClick={()=> removeItem(idx)}>remove</button>
                  </div>
                </div>
              ))}
              <button className="px-3 py-1 bg-green-600 text-white rounded" onClick={addItem}>+ Add Item</button>
            </div>
          </div>

          <div className="mb-3 space-y-1">
            <div className="flex justify-between"><div className="text-sm">Subtotal</div><div className="font-semibold">{money(invoiceTotals(invItems))}</div></div>
            <div className="flex justify-between"><div className="text-sm">Cost</div><div className="font-semibold">{money(invoiceCost(invItems))}</div></div>
            <div className="flex justify-between"><div className="text-sm">Profit</div><div className="font-semibold">{money(invoiceProfit(invItems))}</div></div>
          </div>

          <div className="flex gap-2">
            <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={saveInvoice}>Save Invoice</button>
            <button className="px-3 py-1 border rounded" onClick={()=> setCreating(false)}>Cancel</button>
          </div>
        </div>
      )}

      <div className="space-y-2">
        {invoices.map(inv=> (
          <div key={inv.id} className="p-3 bg-white rounded-xl shadow flex items-start justify-between">
            <div>
              <div className="font-semibold">{inv.number} â€” {new Date(inv.date).toLocaleString()}</div>
              <div className="text-sm text-slate-600">Client: {getClient(inv.clientId)?.name || 'â€”'}</div>
              <div className="mt-2 text-sm">
                {inv.items.map((it, i)=> (
                  <div key={i} className="flex gap-3">
                    <div className="w-40 truncate">{getProduct(it.productId)?.name || 'â€”'}</div>
                    <div>{it.quantity} Ã— {money(it.unitPrice)} (disc {money(it.discountEach)}/item)</div>
                    <div className="font-medium">{money(lineTotal(it))}</div>
                  </div>
                ))}
              </div>
            </div>
            <div className="text-right">
              <div className="text-sm">Total</div>
              <div className="font-semibold">{money(inv.total)}</div>
              <div className="text-sm">Cost: {money(inv.costTotal||0)}</div>
              <div className="text-sm">Profit: {money((inv.profitTotal!=null?inv.profitTotal:(Number(inv.total||0)-Number(inv.costTotal||0))))}</div>
              <div className="mt-2"><button className="px-2 py-1 border rounded" onClick={()=>{
                if(!confirm('Delete invoice?')) return; setInvoices(prev=> prev.filter(x=> x.id!==inv.id));
              }}>Delete</button></div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  const ReportsTab = (
    <Reports
      invoices={invoices}
      payments={payments}
    />
  );

  return (
    <div className="max-w-5xl mx-auto">
      <header className="flex items-center justify-between mb-4">
        <h1 className="text-2xl font-bold">Invoice App (KSh) â€” v2</h1>
        <div className="text-sm text-slate-600">Local-only: data stays in your browser</div>
      </header>

      <nav className="mb-4">
        <div className="flex gap-2">
          <button className={`px-3 py-1 rounded ${tab==='invoices' ? 'bg-blue-600 text-white' : 'border'}`} onClick={()=> setTab('invoices')}>Invoices</button>
          <button className={`px-3 py-1 rounded ${tab==='clients' ? 'bg-blue-600 text-white' : 'border'}`} onClick={()=> setTab('clients')}>Clients</button>
          <button className={`px-3 py-1 rounded ${tab==='products' ? 'bg-blue-600 text-white' : 'border'}`} onClick={()=> setTab('products')}>Products</button>
          <button className={`px-3 py-1 rounded ${tab==='reports' ? 'bg-blue-600 text-white' : 'border'}`} onClick={()=> setTab('reports')}>Reports</button>
          <div className="flex-1"></div>
          <div className="hidden md:flex items-center text-sm text-slate-600">Overall Outstanding: <span className="ml-2 font-semibold">{money(outstandingOverall)}</span></div>
        </div>
      </nav>

      <main>
        {tab==='invoices' && InvoicesTab}
        {tab==='clients' && ClientsTab}
        {tab==='products' && ProductsTab}
        {tab==='reports' && ReportsTab}
      </main>

      <footer className="mt-8 text-sm text-slate-500">Tip: if you updated code, hard-refresh or add <code>?v=3</code> to your site URL to bypass cache.</footer>
    </div>
  );
}

// =====================
// Client row component (expandable) with payments form
// =====================
function ClientRow({ client, outstanding, payments, onAddPayment, onDeletePayment }){
  const [open, setOpen] = useState(false);
  const [amt, setAmt] = useState('');
  const [method, setMethod] = useState('Cash');
  const [dateStr, setDateStr] = useState(''); // yyyy-mm-dd for input
  const [note, setNote] = useState('');

  function submit(){
    const iso = dateStr ? new Date(dateStr).toISOString() : undefined;
    onAddPayment(amt, method, iso, note);
    setAmt(''); setNote(''); setMethod('Cash'); setDateStr('');
  }

  return (
    <div className="border rounded p-2">
      <div className="flex items-center justify-between">
        <div>
          <div className="font-medium">{client.name}</div>
          <div className="text-sm text-slate-600">{client.phone || 'â€”'}</div>
        </div>
        <div className="text-right">
          <div className="text-sm">Outstanding</div>
          <div className="font-semibold">{money(outstanding)}</div>
          <button className="text-xs mt-1 px-2 py-1 border rounded" onClick={()=> setOpen(v=>!v)}>{open? 'Close' : 'Details / Payment'}</button>
        </div>
      </div>

      {open && (
        <div className="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <h4 className="font-semibold mb-2">Add payment</h4>
            <input className="w-full mb-2 p-2 border rounded" placeholder="Amount (KSh)" value={amt} onChange={e=>setAmt(e.target.value)} />
            <div className="grid grid-cols-2 gap-2 mb-2">
              <select className="p-2 border rounded" value={method} onChange={e=>setMethod(e.target.value)}>
                <option>Cash</option>
                <option>M-Pesa</option>
                <option>Bank</option>
                <option>Other</option>
              </select>
              <input type="date" className="p-2 border rounded" value={dateStr} onChange={e=>setDateStr(e.target.value)} />
            </div>
            <input className="w-full mb-2 p-2 border rounded" placeholder="Note (optional)" value={note} onChange={e=>setNote(e.target.value)} />
            <button className="px-3 py-1 bg-blue-600 text-white rounded" onClick={submit}>Save Payment</button>
          </div>

          <div>
            <h4 className="font-semibold mb-2">Recent payments</h4>
            {payments.length===0 && <div className="text-sm text-slate-500">No payments yet</div>}
            <div className="space-y-2 max-h-40 overflow-auto">
              {payments.map(p=> (
                <div key={p.id} className="flex items-center justify-between p-2 border rounded">
                  <div>
                    <div className="font-medium">{money(p.amount)} â€” {p.method}</div>
                    <div className="text-xs text-slate-600">{new Date(p.date).toLocaleDateString()} {p.note? `â€¢ ${p.note}`:''}</div>
                  </div>
                  <button className="text-xs px-2 py-1 border rounded" onClick={()=> onDeletePayment(p.id)}>Delete</button>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// =====================
// Reports component
// =====================
function Reports({ invoices, payments }){
  const [from, setFrom] = useState(''); // yyyy-mm-dd
  const [to, setTo]   = useState('');   // yyyy-mm-dd

  const inRange = (iso) => {
    const t = new Date(iso).getTime();
    if(from){ const f = new Date(from).setHours(0,0,0,0); if(t < f) return false; }
    if(to){ const x = new Date(to).setHours(23,59,59,999); if(t > x) return false; }
    return true;
  };

  const invs = useMemo(()=> invoices.filter(i=> inRange(i.date)), [invoices, from, to]);
  const pays = useMemo(()=> payments.filter(p=> inRange(p.date)), [payments, from, to]);

  const sales   = invs.reduce((s,i)=> s + Number(i.total||0), 0);
  const cost    = invs.reduce((s,i)=> s + Number(i.costTotal||0), 0);
  const profit  = sales - cost;
  const collected = pays.reduce((s,p)=> s + Number(p.amount||0), 0);

  return (
    <div className="p-4 bg-white rounded-xl shadow">
      <h3 className="font-semibold mb-3">Reports</h3>
      <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
        <input type="date" className="p-2 border rounded" value={from} onChange={e=>setFrom(e.target.value)} />
        <input type="date" className="p-2 border rounded" value={to} onChange={e=>setTo(e.target.value)} />
        <button className="p-2 border rounded" onClick={()=>{setFrom(''); setTo('');}}>Clear dates</button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
        <StatCard title="Sales" value={money(sales)} />
        <StatCard title="Cost" value={money(cost)} />
        <StatCard title="Profit" value={money(profit)} />
        <StatCard title="Payments collected" value={money(collected)} />
      </div>

      <div className="mt-4 text-xs text-slate-500">Tip: Profit = (sum of (price - discountEach - cost) Ã— qty) using cost price snapshot at time of invoice.</div>
    </div>
  );
}

function StatCard({ title, value }){
  return (
    <div className="p-4 border rounded-xl">
      <div className="text-sm text-slate-600">{title}</div>
      <div className="text-xl font-semibold">{value}</div>
    </div>
  );
}

// =====================
// Mount
// =====================
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
